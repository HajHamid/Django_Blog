{% extends 'blog/base.html' %}

{% load mathfilters %}
{% load jalali_tags %}
{% load crispy_forms_tags %}

{% block title %}صفحه اصلی {% endblock %}

{% block content %}
<section class="content-header">
    <div class="container-fluid">
        <h4>دسته بندی ها</h4>
        <div class="row">
            <div class="col-md-4 col-sm-6 col-12">
                <div class="info-box bg-info">
                    <span class="info-box-icon">
                        <svg style="font-size: 50px;" width="1em" height="1em" viewBox="0 0 16 16"
                            class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                            <path fill-rule="evenodd"
                                d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                        </svg>
                    </span>
                    <div class="info-box-content">
                        {% for category in categories %}
                        {% if category.name == 'info' %}
                        <span class="info-box-text">تالیفی</span>
                        <span class="info-box-number">{{ category.total_post }}</span>

                        <div class="progress">
                            <div class="progress-bar"
                                style="width: {{ category.total_post|mul:100|div:page_obj.paginator.count|floatformat:"0" }}%">
                            </div>
                        </div>
                        <span class="progress-description">
                            {{ category.total_post|mul:100|div:page_obj.paginator.count|floatformat:"0" }}% از پست ها
                        </span>
                        {% endif %}
                        {% empty %}
                        پستی وارد نشده است
                        {% endfor %}
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>
            <!-- /.col -->
            <div class="col-md-4 col-sm-6 col-12">
                <div class="info-box bg-success">
                    <span class="info-box-icon">
                        <svg style="font-size: 50px;" width="1em" height="1em" viewBox="0 0 16 16"
                            class="bi bi-spellcheck" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M8.217 11.068c1.216 0 1.948-.869 1.948-2.31v-.702c0-1.44-.727-2.305-1.929-2.305-.742 0-1.328.347-1.499.889h-.063V3.983h-1.29V11h1.27v-.791h.064c.21.532.776.86 1.499.86zm-.43-1.025c-.66 0-1.113-.518-1.113-1.28V8.12c0-.825.42-1.343 1.098-1.343.684 0 1.075.518 1.075 1.416v.45c0 .888-.386 1.401-1.06 1.401zm-5.583 1.035c.767 0 1.201-.356 1.406-.737h.059V11h1.216V7.519c0-1.314-.947-1.783-2.11-1.783C1.355 5.736.75 6.42.69 7.27h1.216c.064-.323.313-.552.84-.552.527 0 .864.249.864.771v.464H2.346C1.145 7.953.5 8.568.5 9.496c0 .977.693 1.582 1.704 1.582zm.42-.947c-.44 0-.845-.235-.845-.718 0-.395.269-.684.84-.684h.991v.538c0 .503-.444.864-.986.864zm8.897.567c-.577-.4-.9-1.088-.9-1.983v-.65c0-1.42.894-2.338 2.305-2.338 1.352 0 2.119.82 2.139 1.806h-1.187c-.04-.351-.283-.776-.918-.776-.674 0-1.045.517-1.045 1.328v.625c0 .468.121.834.343 1.067l-.737.92z" />
                            <path fill-rule="evenodd"
                                d="M14.469 9.414a.75.75 0 0 1 .117 1.055l-4 5a.75.75 0 0 1-1.116.061l-2.5-2.5a.75.75 0 1 1 1.06-1.06l1.908 1.907 3.476-4.346a.75.75 0 0 1 1.055-.117z" />
                        </svg>
                    </span>

                    <div class="info-box-content">
                        {% for category in categories %}
                        {% if category.name == 'success' %}
                        <span class="info-box-text">ترجمه ای</span>
                        <span class="info-box-number">{{ category.total_post }}</span>

                        <div class="progress">
                            <div class="progress-bar"
                                style="width: {{ category.total_post|mul:100|div:page_obj.paginator.count|floatformat:"0" }}%">
                            </div>
                        </div>
                        <span class="progress-description">
                            {{ category.total_post|mul:100|div:page_obj.paginator.count|floatformat:"0" }}% از پست ها
                        </span>
                        {% endif %}
                        {% empty %}
                        پستی وارد نشده است
                        {% endfor %}
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>
            <!-- /.col -->
            <div class="col-md-4 col-sm-6 col-12">
                <div class="info-box bg-warning">
                    <span class="info-box-icon">
                        <svg style="font-size: 50px;" width="1em" height="1em" viewBox="0 0 16 16"
                            class="bi bi-people-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-5.784 6A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" />
                        </svg>
                    </span>

                    <div class="info-box-content">
                        {% for category in categories %}
                        {% if category.name == 'warning' %}
                        <span class="info-box-text">کاربران</span>
                        <span class="info-box-number">{{ category.total_post }}</span>

                        <div class="progress">
                            <div class="progress-bar"
                                style="width: {{ category.total_post|mul:100|div:page_obj.paginator.count|floatformat:"0" }}%">
                            </div>
                        </div>
                        <span class="progress-description">
                            {{ category.total_post|mul:100|div:page_obj.paginator.count|floatformat:"0" }}% از پست ها
                        </span>
                        {% endif %}
                        {% empty %}
                        پستی وارد نشده است
                        {% endfor %}
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>
        </div>
    </div>
    {% if in_slider_posts %}
    <div class="container mb-3">
        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                {% for post in in_slider_posts|slice:3 %}
                {% if forloop.first %}
                <div class="carousel-item active">
                    <img class="d-block w-100" src="{{ post.image.url }}" alt="First slide">
                    <div class="carousel-caption">
                        <a style="color: white;" href="{% url 'post-detail' post.id %}">{{ post.title }}</a>
                    </div>
                </div>
                {% else %}
                <div class="carousel-item">
                    <img class="d-block w-100" src="{{ post.image.url }}" alt="Second slide">
                    <div class="carousel-caption">
                        <a style="color: white;" href="{% url 'post-detail' post.id %}">{{ post.title }}</a>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
    {% endif %}
    <div class="container-fluid">
        <h4>آخرین پست ها</h4>
    </div>
</section>
<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <div class="row">
            {% for post in posts %}
            <div class="col-md-6">
                <!-- Box Comment -->
                <div class="card card-widget">
                    <div class="card-header">
                        <div class="user-block">
                            <img class="img-circle" src="{{ post.author.profile.image.url }}" alt="User Image">
                            {% if post.author.get_full_name %}
                            <span class="username">
                                <i class="fa fa-user"></i>
                                <a href="{% url 'user-post' post.author.username %}">{{ post.author.get_full_name }}</a>
                            </span>
                            {% else %}
                            <span class="username">
                                <i class="fa fa-user"></i>
                                <a href="{% url 'user-post' post.author.username %}">{{ post.author.username }}</a>
                            </span>
                            {% endif %}
                            {% if post.get_date_posted == 0 %}
                            <span class="description">امروز</span>
                            {% else %}
                            <span class="description">
                                <i class="fa fa-calendar"></i>
                                {{ post.date_posted|to_jalali:'%y/%m/%d' }}
                            </span>
                            {% endif %}
                        </div>
                        <!-- /.user-block -->

                        <div class="card-tools">
                            {% for read in reads %}
                            {% if read.post == post and read.user == request.user %}
                            <a href="#" class="btn btn-tool" data-toggle="tooltip" title="خوانده شده">
                                <i class="far fa-check-circle"></i></a>
                            {% endif %}
                            {% endfor %}
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i></button>
                        </div>
                        <!-- /.card-tools -->
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body">
                        <div class="ribbon-wrapper">
                            <a href="#">
                                <div class="ribbon bg-{{ post.category.name }}">
                                    {% if post.category.name == 'info' %}
                                    تالیفی
                                    {% elif post.category.name == 'success' %}
                                    ترجمه ای
                                    {% elif post.category.name == 'warning' %}
                                    کاربران
                                    {% endif %}
                                </div>
                            </a>
                        </div>
                        <img class="img-fluid pad" src="{{ post.image.url }}" alt="Photo">
                        <a href="{% url 'post-detail' post.id %}"
                            style="display: block; margin-top: 10px; font-weight: 700;">{{ post.title }}</a>
                        <p>{{ post.brief }}</p>

                        <span class="float-right text-muted">{{ post.likes.count }} لایک - {{ post.comments.count }}
                            نظر</span>
                        <span class="float-left text-muted">زمان مطالعه : {{ post.read_time|time:'i' }} دقیقه</span>
                    </div>
                    <!-- /.card-body -->
                    {% if user.is_authenticated %}
                    <!-- /.card-footer -->
                    <div class="card-footer">
                        <!-- <form method="post">{% csrf_token %}
                            <img class="img-fluid img-circle img-sm" src="{{ user.profile.image.url }}" alt="Alt Text">

                            <div class="img-push">
                                {{ form|crispy }}

                                <button type="submit" class="btn btn-primary">ثبت</button>
                            </div>
                        </form> -->

                        <form method="POST" action="{% url 'post-detail' post.id %}">
                            {% csrf_token %}
                            <div class="row">
                                {{ form|crispy }}
                                <div class="col-sm-2" style="max-width: fit-content;">
                                    <button type="submit" class="btn btn-block btn-secondary">ارسال</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    {% endif %}
                    <!-- /.card-footer -->
                </div>
                <!-- /.card -->
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="mt-3" style="text-align: center;">
        {% if is_paginated %}

        {% if page_obj.has_previous %}
        <a class="btn btn-outline-info mb-4" href="?page=1">اولین صفحه</a>
        <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.previous_page_number }}">قبلی</a>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
        <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
        <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
        {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.next_page_number }}">بعدی</a>
        <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.paginator.num_pages }}">آخرین صفحه</a>
        {% endif %}

        {% endif %}
    </div>
</section>
{% endblock content%}